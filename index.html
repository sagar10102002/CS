<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Communication Evaluator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <style>
    :root {
      --bg-dark: #000000;
      --bg-light: #ffffff;
      --text-dark: #f1f1f1;
      --text-light: #1e1e2f;
      --primary: #4f46e5;
      --secondary: #10b981;
      --border-radius: 12px;
    }

    html[data-theme="dark"] {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }

    html[data-theme="light"] {
      background-color: var(--bg-light);
      color: var(--text-light);
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 30px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    .container {
      max-width: 700px;
      width: 100%;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: var(--border-radius);
      padding: 30px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    h1 {
      font-size: 28px;
      margin-bottom: 20px;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
      margin-bottom: 25px;
    }

    .record-btn {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
      font-weight: bold;
      background-color: var(--primary);
      color: white;
      padding: 12px 24px;
      border-radius: var(--border-radius);
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .record-btn:hover {
      background-color: #3730a3;
    }

    .mic-icon {
      font-size: 24px;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    #totalScoreBox {
      margin-top: 25px;
      font-size: 22px;
      font-weight: bold;
      text-align: center;
      padding: 12px;
      background-color: var(--secondary);
      border-radius: var(--border-radius);
      color: white;
      display: none;
    }

    canvas {
      margin-top: 30px;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.04);
      border-radius: var(--border-radius);
      display: none;
    }

    #themeToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 18px;
      border: none;
      border-radius: 20px;
      background-color: var(--primary);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 22px;
      }

      .record-btn {
        flex-direction: column;
        gap: 8px;
        font-size: 16px;
      }

      .mic-icon {
        font-size: 28px;
      }
    }
  </style>
</head>
<body>
  <button id="themeToggle">Switch Theme</button>
  <div class="container">
    <h1>Evaluate Your Communication Skill</h1>
    <input type="text" id="nameInput" placeholder="Enter your name..." />
    <button id="micButton" class="record-btn">
      <i class="fas fa-microphone mic-icon" id="micIcon"></i>
      <span id="recordLabel">Start Recording</span>
    </button>
    <div id="totalScoreBox">Total Score: <span id="totalScore">0</span>/100</div>
    <canvas id="performanceChart" width="300" height="200"></canvas>
    <audio id="applauseSound" src="https://www.soundjay.com/human/applause-01.mp3" preload="auto"></audio>
  </div>

  <script>
    const micButton = document.getElementById("micButton");
    const micIcon = document.getElementById("micIcon");
    const recordLabel = document.getElementById("recordLabel");
    const totalScoreBox = document.getElementById("totalScoreBox");
    const totalScoreSpan = document.getElementById("totalScore");
    const nameInput = document.getElementById("nameInput");
    const canvas = document.getElementById("performanceChart");
    const themeToggle = document.getElementById("themeToggle");

    let recognition;
    let isRecording = false;
    let finalTranscript = "";

    if ("webkitSpeechRecognition" in window || "SpeechRecognition" in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = "en-US";

      recognition.onresult = (event) => {
        for (let i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            finalTranscript += event.results[i][0].transcript + " ";
          }
        }
      };

      recognition.onerror = (event) => {
        alert("Speech recognition error: " + event.error);
        stopRecordingUI();
      };

      recognition.onend = () => {
        if (isRecording) {
          stopRecordingUI();
          evaluateTranscript(finalTranscript);
        }
      };

      micButton.addEventListener("click", () => {
        if (!isRecording) {
          finalTranscript = "";
          navigator.mediaDevices.getUserMedia({ audio: true })
            .then(() => {
              recognition.start();
              startRecordingUI();
            })
            .catch(err => {
              alert("Microphone access denied: " + err.message);
            });
        } else {
          recognition.stop();
        }
      });
    } else {
      alert("Speech Recognition not supported in this browser.");
      micButton.disabled = true;
    }

    function startRecordingUI() {
      isRecording = true;
      micIcon.classList.remove("fa-microphone");
      micIcon.classList.add("fa-stop");
      recordLabel.textContent = "Stop Recording";
    }

    function stopRecordingUI() {
      isRecording = false;
      micIcon.classList.remove("fa-stop");
      micIcon.classList.add("fa-microphone");
      recordLabel.textContent = "Start Recording";
    }

    function evaluateTranscript(text) {
      let grammarMistakes = (text.match(/\b(is|are|was|were|the|a|an)\b/g) || []).length;
      let grammarScore = Math.max(100 - grammarMistakes * 2, 0);

      const words = text.toLowerCase().split(/\s+/);
      const uniqueLongWords = new Set(words.filter(w => w.length > 4));
      let depthScore = Math.min(uniqueLongWords.size * 2, 100);

      let totalScore = Math.round((grammarScore + depthScore) / 2);
      totalScoreSpan.textContent = totalScore;
      totalScoreBox.style.display = "block";
      canvas.style.display = "block";

      speakFeedback(nameInput.value || "User", totalScore);
      showPerformanceChart(grammarScore, depthScore);

      if (totalScore >= 70) {
        document.getElementById("applauseSound").play();
      }
    }

    function speakFeedback(name, score) {
      const message = `Hi ${name}, your total communication skill score is ${score}. Keep improving!`;
      const utterance = new SpeechSynthesisUtterance(message);
      utterance.rate = 1;
      utterance.pitch = 1;
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }

    function showPerformanceChart(grammar, depth) {
      const ctx = document.getElementById('performanceChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Grammar', 'Depth'],
          datasets: [{
            label: 'Score',
            data: [grammar, depth],
            backgroundColor: ['#4bc0c0', '#facc15'],
            borderColor: '#fff',
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              max: 100
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    themeToggle.addEventListener("click", () => {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", newTheme);
      themeToggle.textContent = newTheme === "dark" ? "Switch Theme" : "Switch Theme";
    });
  </script>
</body>
</html>
